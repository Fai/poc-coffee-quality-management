{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.235.1"},"children":{"CoffeeQM-AI":{"id":"CoffeeQM-AI","path":"CoffeeQM-AI","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.235.1"},"children":{"ImagesBucket":{"id":"ImagesBucket","path":"CoffeeQM-AI/ImagesBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/ImagesBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"corsConfiguration":{"corsRules":[{"allowedHeaders":["*"],"allowedMethods":["GET","PUT","POST"],"allowedOrigins":["*"]}]},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"Environment","value":"test"},{"key":"Project","value":"CoffeeQualityManagement"}]}}},"Policy":{"id":"Policy","path":"CoffeeQM-AI/ImagesBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/ImagesBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"ImagesBucket1E86AFB2"},"policyDocument":{"Statement":[{"Action":["s3:PutBucketPolicy","s3:GetBucket*","s3:List*","s3:DeleteObject*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["ImagesBucket1E86AFB2","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ImagesBucket1E86AFB2","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"CoffeeQM-AI/ImagesBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.235.1","metadata":[]},"children":{"Default":{"id":"Default","path":"CoffeeQM-AI/ImagesBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.235.1"}}}}}},"Custom::S3AutoDeleteObjectsCustomResourceProvider":{"id":"Custom::S3AutoDeleteObjectsCustomResourceProvider","path":"CoffeeQM-AI/Custom::S3AutoDeleteObjectsCustomResourceProvider","constructInfo":{"fqn":"aws-cdk-lib.CustomResourceProviderBase","version":"2.235.1"},"children":{"Staging":{"id":"Staging","path":"CoffeeQM-AI/Custom::S3AutoDeleteObjectsCustomResourceProvider/Staging","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.235.1"}},"Role":{"id":"Role","path":"CoffeeQM-AI/Custom::S3AutoDeleteObjectsCustomResourceProvider/Role","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.235.1"}},"Handler":{"id":"Handler","path":"CoffeeQM-AI/Custom::S3AutoDeleteObjectsCustomResourceProvider/Handler","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.235.1"}}}},"FrontendBucket":{"id":"FrontendBucket","path":"CoffeeQM-AI/FrontendBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/FrontendBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"publicAccessBlockConfiguration":{"blockPublicAcls":true,"ignorePublicAcls":true},"tags":[{"key":"aws-cdk:auto-delete-objects","value":"true"},{"key":"Environment","value":"test"},{"key":"Project","value":"CoffeeQualityManagement"}],"websiteConfiguration":{"indexDocument":"index.html","errorDocument":"index.html"}}}},"Policy":{"id":"Policy","path":"CoffeeQM-AI/FrontendBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/FrontendBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"FrontendBucketEFE2E19C"},"policyDocument":{"Statement":[{"Action":"s3:GetObject","Effect":"Allow","Principal":{"AWS":"*"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["FrontendBucketEFE2E19C","Arn"]},"/*"]]}},{"Action":["s3:PutBucketPolicy","s3:GetBucket*","s3:List*","s3:DeleteObject*"],"Effect":"Allow","Principal":{"AWS":{"Fn::GetAtt":["CustomS3AutoDeleteObjectsCustomResourceProviderRole3B1BD092","Arn"]}},"Resource":[{"Fn::GetAtt":["FrontendBucketEFE2E19C","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["FrontendBucketEFE2E19C","Arn"]},"/*"]]}]}],"Version":"2012-10-17"}}}}}},"AutoDeleteObjectsCustomResource":{"id":"AutoDeleteObjectsCustomResource","path":"CoffeeQM-AI/FrontendBucket/AutoDeleteObjectsCustomResource","constructInfo":{"fqn":"aws-cdk-lib.CustomResource","version":"2.235.1","metadata":[]},"children":{"Default":{"id":"Default","path":"CoffeeQM-AI/FrontendBucket/AutoDeleteObjectsCustomResource/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.235.1"}}}}}},"AIRepo":{"id":"AIRepo","path":"CoffeeQM-AI/AIRepo","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.Repository","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIRepo/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ecr.CfnRepository","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ECR::Repository","aws:cdk:cloudformation:props":{"emptyOnDelete":true,"repositoryName":"coffee-qm-ai","tags":[{"key":"Environment","value":"test"},{"key":"Project","value":"CoffeeQualityManagement"}]}}}}},"AIBuildProject":{"id":"AIBuildProject","path":"CoffeeQM-AI/AIBuildProject","constructInfo":{"fqn":"aws-cdk-lib.aws_codebuild.Project","version":"2.235.1","metadata":[]},"children":{"Role":{"id":"Role","path":"CoffeeQM-AI/AIBuildProject/Role","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.235.1","metadata":[]},"children":{"ImportRole":{"id":"ImportRole","path":"CoffeeQM-AI/AIBuildProject/Role/ImportRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.235.1","metadata":[]}},"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIBuildProject/Role/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"codebuild.amazonaws.com"}}],"Version":"2012-10-17"},"tags":[{"key":"Environment","value":"test"},{"key":"Project","value":"CoffeeQualityManagement"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"CoffeeQM-AI/AIBuildProject/Role/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIBuildProject/Role/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:CreateLogGroup","logs:CreateLogStream","logs:PutLogEvents"],"Effect":"Allow","Resource":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:ap-southeast-1:215665150081:log-group:/aws/codebuild/",{"Ref":"AIBuildProject41900C14"}]]},{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":logs:ap-southeast-1:215665150081:log-group:/aws/codebuild/",{"Ref":"AIBuildProject41900C14"},":*"]]}]},{"Action":["codebuild:CreateReportGroup","codebuild:CreateReport","codebuild:UpdateReport","codebuild:BatchPutTestCases","codebuild:BatchPutCodeCoverages"],"Effect":"Allow","Resource":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":codebuild:ap-southeast-1:215665150081:report-group/",{"Ref":"AIBuildProject41900C14"},"-*"]]}},{"Action":["ecr:BatchCheckLayerAvailability","ecr:GetDownloadUrlForLayer","ecr:BatchGetImage","ecr:CompleteLayerUpload","ecr:UploadLayerPart","ecr:InitiateLayerUpload","ecr:PutImage"],"Effect":"Allow","Resource":{"Fn::GetAtt":["AIRepo4D2E9FDE","Arn"]}},{"Action":"ecr:GetAuthorizationToken","Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"AIBuildProjectRoleDefaultPolicy1B15824B","roles":[{"Ref":"AIBuildProjectRoleB807A93D"}]}}}}}}},"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIBuildProject/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_codebuild.CfnProject","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CodeBuild::Project","aws:cdk:cloudformation:props":{"artifacts":{"type":"NO_ARTIFACTS"},"cache":{"type":"NO_CACHE"},"encryptionKey":"alias/aws/s3","environment":{"type":"LINUX_CONTAINER","image":"aws/codebuild/standard:7.0","imagePullCredentialsType":"CODEBUILD","privilegedMode":true,"computeType":"BUILD_GENERAL1_MEDIUM","environmentVariables":[{"name":"ECR_REPO_URI","type":"PLAINTEXT","value":{"Fn::Join":["",[{"Fn::Select":[4,{"Fn::Split":[":",{"Fn::GetAtt":["AIRepo4D2E9FDE","Arn"]}]}]},".dkr.ecr.",{"Fn::Select":[3,{"Fn::Split":[":",{"Fn::GetAtt":["AIRepo4D2E9FDE","Arn"]}]}]},".",{"Ref":"AWS::URLSuffix"},"/",{"Ref":"AIRepo4D2E9FDE"}]]}},{"name":"AWS_ACCOUNT_ID","type":"PLAINTEXT","value":"215665150081"},{"name":"AWS_REGION","type":"PLAINTEXT","value":"ap-southeast-1"},{"name":"BUCKET_NAME","type":"PLAINTEXT","value":{"Ref":"ImagesBucket1E86AFB2"}}]},"name":"coffee-qm-ai-build","serviceRole":{"Fn::GetAtt":["AIBuildProjectRoleB807A93D","Arn"]},"source":{"type":"NO_SOURCE","buildSpec":"{\n  \"version\": \"0.2\",\n  \"phases\": {\n    \"pre_build\": {\n      \"commands\": [\n        \"aws ecr get-login-password --region $AWS_REGION | docker login --username AWS --password-stdin $AWS_ACCOUNT_ID.dkr.ecr.$AWS_REGION.amazonaws.com\"\n      ]\n    },\n    \"build\": {\n      \"commands\": [\n        \"cat > Dockerfile << 'EOF'\\nFROM public.ecr.aws/lambda/python:3.11\\nCOPY requirements.txt ${LAMBDA_TASK_ROOT}/\\nRUN pip install --no-cache-dir -r ${LAMBDA_TASK_ROOT}/requirements.txt\\nRUN python -c \\\"from transformers import pipeline; pipeline('image-classification', model='everycoffee/autotrain-coffee-bean-quality-97496146930')\\\"\\nCOPY lambda_handler.py ${LAMBDA_TASK_ROOT}/\\nCMD [\\\"lambda_handler.handler\\\"]\\nEOF\",\n        \"cat > requirements.txt << 'EOF'\\nboto3>=1.34.0\\ntransformers>=4.36.0\\ntorch>=2.1.0\\nPillow>=10.0.0\\nEOF\",\n        \"cat > lambda_handler.py << 'EOF'\\nimport json, boto3, base64, os, uuid\\nfrom datetime import datetime\\nfrom io import BytesIO\\ns3 = boto3.client(\\\"s3\\\")\\nBUCKET = os.environ.get(\\\"BUCKET_NAME\\\")\\nMODEL = \\\"everycoffee/autotrain-coffee-bean-quality-97496146930\\\"\\n_clf = None\\ndef get_clf():\\n    global _clf\\n    if _clf is None:\\n        from transformers import pipeline\\n        _clf = pipeline(\\\"image-classification\\\", model=MODEL)\\n    return _clf\\ndef handler(event, context):\\n    try:\\n        body = json.loads(event.get(\\\"body\\\", \\\"{}\\\"))\\n        img_b64 = body.get(\\\"image_base64\\\")\\n        if not img_b64:\\n            return {\\\"statusCode\\\": 400, \\\"headers\\\": {\\\"Content-Type\\\": \\\"application/json\\\", \\\"Access-Control-Allow-Origin\\\": \\\"*\\\"}, \\\"body\\\": json.dumps({\\\"error\\\": \\\"Missing image_base64\\\"})}\\n        rid = f\\\"det-{datetime.utcnow().strftime('%Y%m%d%H%M%S')}-{str(uuid.uuid4())[:8]}\\\"\\n        t0 = datetime.utcnow()\\n        img_bytes = base64.b64decode(img_b64)\\n        key = f\\\"uploads/{rid}.jpg\\\"\\n        s3.put_object(Bucket=BUCKET, Key=key, Body=img_bytes, ContentType=\\\"image/jpeg\\\")\\n        from PIL import Image\\n        img = Image.open(BytesIO(img_bytes)).convert(\\\"RGB\\\")\\n        res = get_clf()(img)\\n        d_score = next((r[\\\"score\\\"] for r in res if r[\\\"label\\\"].lower() == \\\"defect\\\"), 0.0)\\n        g_score = next((r[\\\"score\\\"] for r in res if r[\\\"label\\\"].lower() != \\\"defect\\\"), 0.0)\\n        is_def = d_score > g_score\\n        ms = int((datetime.utcnow() - t0).total_seconds() * 1000)\\n        return {\\\"statusCode\\\": 200, \\\"headers\\\": {\\\"Content-Type\\\": \\\"application/json\\\", \\\"Access-Control-Allow-Origin\\\": \\\"*\\\"}, \\\"body\\\": json.dumps({\\\"request_id\\\": rid, \\\"detection\\\": {\\\"request_id\\\": rid, \\\"image_url\\\": f\\\"s3://{BUCKET}/{key}\\\", \\\"is_defective\\\": is_def, \\\"defect_probability\\\": d_score, \\\"confidence_score\\\": max(d_score, g_score), \\\"processing_time_ms\\\": ms, \\\"model\\\": MODEL, \\\"note\\\": \\\"Binary classification\\\"}, \\\"suggested_grade\\\": \\\"needs_inspection\\\" if is_def else \\\"likely_specialty\\\"})}\\n    except Exception as e:\\n        return {\\\"statusCode\\\": 500, \\\"headers\\\": {\\\"Content-Type\\\": \\\"application/json\\\", \\\"Access-Control-Allow-Origin\\\": \\\"*\\\"}, \\\"body\\\": json.dumps({\\\"error\\\": str(e)})}\\nEOF\",\n        \"docker build -t $ECR_REPO_URI:latest .\"\n      ]\n    },\n    \"post_build\": {\n      \"commands\": [\n        \"docker push $ECR_REPO_URI:latest\"\n      ]\n    }\n  }\n}"},"tags":[{"key":"Environment","value":"test"},{"key":"Project","value":"CoffeeQualityManagement"}],"timeoutInMinutes":30}}}}},"AIDetectLambda":{"id":"AIDetectLambda","path":"CoffeeQM-AI/AIDetectLambda","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.235.1","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"CoffeeQM-AI/AIDetectLambda/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.235.1","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"CoffeeQM-AI/AIDetectLambda/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.235.1","metadata":[]}},"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIDetectLambda/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}],"tags":[{"key":"Environment","value":"test"},{"key":"Project","value":"CoffeeQualityManagement"}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"CoffeeQM-AI/AIDetectLambda/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIDetectLambda/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:GetObject*","s3:GetBucket*","s3:List*","s3:DeleteObject*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging","s3:Abort*"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["ImagesBucket1E86AFB2","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["ImagesBucket1E86AFB2","Arn"]},"/*"]]}]}],"Version":"2012-10-17"},"policyName":"AIDetectLambdaServiceRoleDefaultPolicy8AE5632F","roles":[{"Ref":"AIDetectLambdaServiceRole92EE047B"}]}}}}}}},"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIDetectLambda/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json, random\ndef handler(event, context):\n    is_def = random.random() > 0.5\n    return {\"statusCode\": 200, \"headers\": {\"Content-Type\": \"application/json\", \"Access-Control-Allow-Origin\": \"*\"}, \"body\": json.dumps({\"request_id\": \"placeholder\", \"detection\": {\"is_defective\": is_def, \"defect_probability\": 0.5, \"confidence_score\": 0.5, \"processing_time_ms\": 100, \"model\": \"placeholder\", \"note\": \"Run CodeBuild to deploy real model\"}, \"suggested_grade\": \"needs_inspection\" if is_def else \"likely_specialty\"})}\n"},"environment":{"variables":{"BUCKET_NAME":{"Ref":"ImagesBucket1E86AFB2"}}},"functionName":"coffee-qm-ai-detect","handler":"index.handler","memorySize":3008,"role":{"Fn::GetAtt":["AIDetectLambdaServiceRole92EE047B","Arn"]},"runtime":"python3.11","tags":[{"key":"Environment","value":"test"},{"key":"Project","value":"CoffeeQualityManagement"}],"timeout":60}}}}},"AIApi":{"id":"AIApi","path":"CoffeeQM-AI/AIApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpApi","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"corsConfiguration":{"allowHeaders":["*"],"allowMethods":["POST","OPTIONS"],"allowOrigins":["*"]},"name":"coffee-qm-ai-test","protocolType":"HTTP","tags":{"Environment":"test","Project":"CoffeeQualityManagement"}}}},"DefaultStage":{"id":"DefaultStage","path":"CoffeeQM-AI/AIApi/DefaultStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpStage","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIApi/DefaultStage/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"apiId":{"Ref":"AIApi2A8B32A5"},"autoDeploy":true,"stageName":"$default","tags":{"Environment":"test","Project":"CoffeeQualityManagement"}}}}}},"POST--detect":{"id":"POST--detect","path":"CoffeeQM-AI/AIApi/POST--detect","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.235.1","metadata":[]},"children":{"AIIntegration":{"id":"AIIntegration","path":"CoffeeQM-AI/AIApi/POST--detect/AIIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.235.1","metadata":[]},"children":{"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIApi/POST--detect/AIIntegration/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"AIApi2A8B32A5"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["AIDetectLambda937CCEAF","Arn"]},"payloadFormatVersion":"2.0"}}}}},"AIIntegration-Permission":{"id":"AIIntegration-Permission","path":"CoffeeQM-AI/AIApi/POST--detect/AIIntegration-Permission","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["AIDetectLambda937CCEAF","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":execute-api:ap-southeast-1:215665150081:",{"Ref":"AIApi2A8B32A5"},"/*/*/detect"]]}}}},"Resource":{"id":"Resource","path":"CoffeeQM-AI/AIApi/POST--detect/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.235.1"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"AIApi2A8B32A5"},"authorizationType":"NONE","routeKey":"POST /detect","target":{"Fn::Join":["",["integrations/",{"Ref":"AIApiPOSTdetectAIIntegration57088B9C"}]]}}}}}}}},"FrontendURL":{"id":"FrontendURL","path":"CoffeeQM-AI/FrontendURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.235.1"}},"AIApiURL":{"id":"AIApiURL","path":"CoffeeQM-AI/AIApiURL","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.235.1"}},"FrontendBucketName":{"id":"FrontendBucketName","path":"CoffeeQM-AI/FrontendBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.235.1"}},"CodeBuildProject":{"id":"CodeBuildProject","path":"CoffeeQM-AI/CodeBuildProject","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.235.1"}},"ECRRepository":{"id":"ECRRepository","path":"CoffeeQM-AI/ECRRepository","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.235.1"}},"LambdaName":{"id":"LambdaName","path":"CoffeeQM-AI/LambdaName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.235.1"}},"CDKMetadata":{"id":"CDKMetadata","path":"CoffeeQM-AI/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.5"},"children":{"Default":{"id":"Default","path":"CoffeeQM-AI/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.235.1"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"CoffeeQM-AI/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.235.1"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"CoffeeQM-AI/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.235.1"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.5"}}}}}